# ConfigMap — RabbitMQ Dashboard
# Grafana sidecar tự động load dashboard có label grafana_dashboard="1"
# Yêu cầu: RabbitMQ với rabbitmq_prometheus plugin (port 15692), Prometheus scrape job rabbitmq
#
# Apply: kubectl apply -f grafana-dashboard-rabbitmq.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-rabbitmq
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  rabbitmq-monitoring.json: |
    {"annotations":{"list":[]},"editable":true,"fiscalYearStartMonth":0,"graphTooltip":1,"id":null,"links":[{"icon":"link","tags":[],"targetBlank":true,"title":"RabbitMQ Docs","tooltip":"","type":"link","url":"https://www.rabbitmq.com/prometheus.html"}],"liveNow":false,"panels":[{"id":1,"type":"stat","title":"Queues","gridPos":{"x":0,"y":0,"w":4,"h":4},"targets":[{"expr":"sum(rabbitmq_queues) or vector(0)","refId":"A"}],"fieldConfig":{"defaults":{"unit":"short"}},"options":{}},{"id":2,"type":"stat","title":"Consumers","gridPos":{"x":4,"y":0,"w":4,"h":4},"targets":[{"expr":"sum(rabbitmq_channel_consumers) or vector(0)","refId":"A"}],"fieldConfig":{"defaults":{"unit":"short"}},"options":{}},{"id":3,"type":"stat","title":"Connections","gridPos":{"x":8,"y":0,"w":4,"h":4},"targets":[{"expr":"sum(rabbitmq_connections) or vector(0)","refId":"A"}],"fieldConfig":{"defaults":{"unit":"short"}},"options":{}},{"id":4,"type":"stat","title":"Channels","gridPos":{"x":12,"y":0,"w":4,"h":4},"targets":[{"expr":"sum(rabbitmq_channels) or vector(0)","refId":"A"}],"fieldConfig":{"defaults":{"unit":"short"}},"options":{}},{"id":5,"type":"stat","title":"Messages Ready","gridPos":{"x":16,"y":0,"w":4,"h":4},"targets":[{"expr":"sum(rabbitmq_queue_messages_ready) or vector(0)","refId":"A"}],"fieldConfig":{"defaults":{"unit":"short"},"overrides":[{"matcher":{"id":"byName","options":"Value"},"properties":[{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":1000},{"color":"red","value":10000}]}}]}]},"options":{}},{"id":6,"type":"stat","title":"Messages Unacked","gridPos":{"x":20,"y":0,"w":4,"h":4},"targets":[{"expr":"sum(rabbitmq_queue_messages_unacked) or vector(0)","refId":"A"}],"fieldConfig":{"defaults":{"unit":"short"},"overrides":[{"matcher":{"id":"byName","options":"Value"},"properties":[{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":100},{"color":"red","value":500}]}}]}]},"options":{}},{"id":7,"type":"timeseries","title":"Message Rate — Published (msg/s)","gridPos":{"x":0,"y":4,"w":12,"h":8},"targets":[{"expr":"sum(rate(rabbitmq_channel_messages_published_total[5m]))","legendFormat":"Published","refId":"A"}],"fieldConfig":{"defaults":{"unit":"short"}},"options":{}},{"id":8,"type":"timeseries","title":"Message Rate — Delivered (msg/s)","gridPos":{"x":12,"y":4,"w":12,"h":8},"targets":[{"expr":"sum(rate(rabbitmq_channel_messages_delivered_total[5m]))","legendFormat":"Delivered","refId":"A"}],"fieldConfig":{"defaults":{"unit":"short"}},"options":{}},{"id":9,"type":"timeseries","title":"Queue Messages — Ready vs Unacked","gridPos":{"x":0,"y":12,"w":12,"h":8},"targets":[{"expr":"sum(rabbitmq_queue_messages_ready)","legendFormat":"Ready","refId":"A"},{"expr":"sum(rabbitmq_queue_messages_unacked)","legendFormat":"Unacked","refId":"B"}],"fieldConfig":{"defaults":{"unit":"short"}},"options":{}},{"id":10,"type":"timeseries","title":"Connections & Channels","gridPos":{"x":12,"y":12,"w":12,"h":8},"targets":[{"expr":"sum(rabbitmq_connections)","legendFormat":"Connections","refId":"A"},{"expr":"sum(rabbitmq_channels)","legendFormat":"Channels","refId":"B"}],"fieldConfig":{"defaults":{"unit":"short"}},"options":{}},{"id":11,"type":"timeseries","title":"Memory — Resident (bytes)","gridPos":{"x":0,"y":20,"w":12,"h":8},"targets":[{"expr":"rabbitmq_process_resident_memory_bytes","legendFormat":"{{instance}}","refId":"A"}],"fieldConfig":{"defaults":{"unit":"bytes"}},"options":{}},{"id":12,"type":"timeseries","title":"Disk Space Available (bytes)","gridPos":{"x":12,"y":20,"w":12,"h":8},"targets":[{"expr":"rabbitmq_disk_space_available_bytes","legendFormat":"{{instance}}","refId":"A"}],"fieldConfig":{"defaults":{"unit":"bytes"},"overrides":[{"matcher":{"id":"byName","options":"Value"},"properties":[{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"yellow","value":5368709120},{"color":"green","value":10737418240}]}}]}]},"options":{}},{"id":13,"type":"timeseries","title":"File Descriptors — Open vs Max","gridPos":{"x":0,"y":28,"w":12,"h":8},"targets":[{"expr":"rabbitmq_process_open_fds","legendFormat":"Open FDs {{instance}}","refId":"A"},{"expr":"rabbitmq_process_max_fds","legendFormat":"Max FDs {{instance}}","refId":"B"}],"fieldConfig":{"defaults":{"unit":"short"}},"options":{}},{"id":14,"type":"gauge","title":"Memory Usage % (vs limit)","gridPos":{"x":12,"y":28,"w":12,"h":8},"targets":[{"expr":"(rabbitmq_process_resident_memory_bytes / rabbitmq_resident_memory_limit_bytes) * 100 or vector(0)","refId":"A"}],"fieldConfig":{"defaults":{"unit":"percent","min":0,"max":100,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":70},{"color":"red","value":90}]}}},"options":{}}],"refresh":"10s","schemaVersion":38,"tags":["rabbitmq","message-queue"],"templating":{"list":[]},"time":{"from":"now-1h","to":"now"},"timepicker":{},"timezone":"","title":"RabbitMQ","uid":"rabbitmq-monitoring","version":1,"weekStart":""}
